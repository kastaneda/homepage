% Как устроен этот сайт: система сборки

Система сборки
==============

Этот сайт полностью статический. Его можно раздавать через CDN, для него
достаточно «лёгких» httpd вроде nginx, а с учётом небольшого веса этот сайт
можно хостить даже на домашнем роутере.

При этом мне очень удобно работать с содержимым сайта. Я пишу этот текст
в формате Markdown при помощи своих текстовых редакторов. Это гораздо
удобнее, чем писать текст в веб-интерфейсе большинства знакомых мне CMS.
Никакая куцая textarea не сможет дать мне всего того, что у меня есть
в полноценном текстовом редакторе.

HTML-страницы собираются из Markdown'а при помощи программы [Pandoc][1]
(а также GNU make и набора моих скриптов). Кроме того, CSS собирается
при помощи препроцессора [LESS][2]. Всё это вместе взятое (тексты сайта,
оформление и система сборки) хранится в [Git-репозитории][3].
Для меня этот подход оказался очень удобным.

Как это работает
----------------

Для сборки требуется GNU make, Pandoc и LESS.
Установка не требует никаких танцев с бубном, это всё есть
в основном репозитории Debian'а:

```sh
sudo apt-get install make pandoc node-less
```

Первый вариант соответствующего Makefile выглядел как-то так:

```Makefile
MARKDOWN = pandoc --from markdown --to html5 --css style.css --standalone

LESS = lessc --compress

SOURCE_PAGES = $(shell find . -type f -name '*.md')
TARGET_PAGES = $(patsubst %.md,%.html,$(SOURCE_PAGES))

all: $(TARGET_PAGES) style.css

%.html: %.md Makefile
    $(MARKDOWN) $< --output $@

style.css: style.less Makefile
    $(LESS) $< > $@

clean:
    rm -f $(TARGET_PAGES) style.css

.PHONY: all clean
```

Сейчас всё устроено [сложнее][4], но базовый принцип остался точно таким же.

Веб-интерфейс
-------------

Всё-таки у меня есть возможность публиковать материалы при помощи одного лишь
браузера. В любом интернет-кафе я могу залогиниться на GitHub'е и прямо там,
в веб-интерфейсе, сделать новый коммит.

В качестве запасного варианта это вполне годится.

Continuous Integration
----------------------

А ещё я прикрутил к этому всему примитивную Continuous Integration,
сделанную из говна, клея ПВА, github webhooks, кронтаба, скриптов
и файлов-флагов. Вроде работает.

TODO: описать CI.

[1]: http://johnmacfarlane.net/pandoc/
[2]: http://lesscss.org/
[3]: https://github.com/kastaneda/homepage
[4]: https://github.com/kastaneda/homepage/blob/master/Makefile
